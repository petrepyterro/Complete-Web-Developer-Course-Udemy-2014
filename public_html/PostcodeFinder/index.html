<!DOCTYPE html>

<html>
  <head>
    <title>TODO supply a title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
      html, body {
        height: 100%;
      }
      .container {
        background-image: url('img/background.jpg');
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        padding-top: 150px;
      }
      .center {
        text-align: center;
      }
      
      p {
        padding-top: 15px;
        padding-bottom: 15px;
      }
      
      button {
        margin-top: 20px;
        margin-bottom: 20px;
      }
      
      .alert {
        margin-top: 20px;
        display: none;
      }
      .whiteBackground {
        background-color: white;
        padding: 20px;
        border-radius: 20px;
      }
      
      
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-md-offset-3 whiteBackground">
          <h1 class="center">Postcode Finder</h1>
          <p class="lead center">Enter any address to find the postcode</p>
          <form class="center" action="">
            <div class="form-group">
              <input type="text" class="form-control" name="address" id="address">
            </div>
            <button id="findMyPostcode" class="btn btn-success btn-lg">Find Postcode</button>
          </form>
          <div id="success" class="alert alert-success">Success!</div>
          <div id="fail" class="alert alert-danger">Could not find postcode data for that address. Please, try again!</div>
          <div id="failConnect" class="alert alert-danger">Could not connect to server</div>
        </div>
      </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-1.12.4.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
      $('#findMyPostcode').click(function(event){
        event.preventDefault();
        $('.alert').hide();
        var result = 0;
        $.ajax({
          type: "GET",
          url: "https://maps.googleapis.com/maps/api/geocode/xml?address=" + encodeURIComponent($('#address').val()) + "&sensor=false&key=AIzaSyBC4m8B9bXjsYCcYvOMVlK30R8m1iPNtuA",
          dataType: "xml",
          success: processXML,
          error: error
        });
        
        function error(){
          $('#failConnect').fadeIn();  
        }
        
        function processXML(xml){
          if ($(xml).find('result').length > 1){
            var pattern = /postal_code$|postal_code_(suffix|prefix)/;
            $(xml).find('result').each(function(){
              var prefix = suffix = postalCode = ''; 
              $(this).find('address_component').each(function(){
                var match = $(this).find("type").text().match(pattern);
                if (match && match[0] == 'postal_code'){
                  postalCode = $(this).find("long_name").text();
                } else if(match && match[0] == 'postal_code_prefix'){
                  prefix = $(this).find("long_name").text(); 
                } else if(match && match[0] == 'postal_code_suffix'){
                  suffix = $(this).find("long_name").text(); 
                }
              });
              if (prefix !== ''){
                postalCode = '(prefix ' + prefix + ') - ' + postalCode;
              }
              if (suffix !== ''){
                postalCode += ' - (' + suffix + ' suffix)';
              }
              console.log(postalCode);
            });  
          } else {
            $(xml).find("address_component").each(function(){
              var pattern = /postal_code$|postal_code[^_](.*?)/;
              if(pattern.test($(this).find("type").text())){
                $('#success').html("The postcode you need is " + $(this).find("long_name").text()).fadeIn();
                result = 1; 
              }
            });
            if (result == 0){
              $("#fail").fadeIn();
            }
          } 
        };
      });  
    </script>
  </body>
</html>